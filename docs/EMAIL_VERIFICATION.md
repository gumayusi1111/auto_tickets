# 邮箱验证码自动获取功能使用指南

本指南详细介绍如何使用邮箱验证码自动获取功能，支持多种邮箱服务商和两种认证方式。

## 支持的邮箱类型

### 1. QQ邮箱 (推荐)
- **IMAP服务器**: imap.qq.com:993
- **配置简单**: 开启IMAP服务即可
- **稳定性**: 高

### 2. 163邮箱
- **IMAP服务器**: imap.163.com:993
- **配置**: 需要开启IMAP/SMTP服务
- **兼容性**: 良好

### 3. Gmail
- **IMAP服务器**: imap.gmail.com:993
- **配置**: 需要开启两步验证和应用专用密码
- **安全性**: 最高

### 4. Outlook/Hotmail
- **IMAP服务器**: outlook.office365.com:993
- **配置**: 相对简单
- **兼容性**: 良好

## 使用方法

### 1. 命令行参数方式

#### 使用授权码（推荐）
```bash
python3 weverse_with_email_verification.py \
  --url "https://weverse.io/example" \
  --email "your_email@qq.com" \
  --email-password "your_auth_code" \
  --sender-filter "weverse"
```

#### 使用真实密码
```bash
python3 weverse_with_email_verification.py \
  --url "https://weverse.io/example" \
  --email "your_email@qq.com" \
  --email-password "your_real_password" \
  --use-real-password \
  --sender-filter "weverse"
```

### 2. 交互式配置
```bash
python3 weverse_with_email_verification.py
```
脚本会提示您选择密码类型（授权码或真实密码），然后输入相应的邮箱信息。

## 重要配置说明

### 1. 密码类型选择

#### 授权码方式（推荐）
- **安全性**: 高，专用于应用访问
- **稳定性**: 好，不受密码变更影响
- **适用场景**: 生产环境、长期使用

#### 真实密码方式
- **安全性**: 较低，直接使用账户密码
- **便利性**: 高，无需额外配置
- **适用场景**: 测试环境、临时使用

### 2. 邮箱授权码获取
授权码是邮箱服务商提供的应用专用密码，比真实密码更安全。

#### QQ邮箱授权码获取
1. 登录QQ邮箱网页版
2. 进入"设置" → "账户"
3. 找到"POP3/IMAP/SMTP/Exchange/CardDAV/CalDAV服务"
4. 开启"IMAP/SMTP服务"
5. 点击"生成授权码"
6. 按提示发送短信获取授权码

#### Gmail应用专用密码
1. 登录Google账户
2. 进入"安全性"设置
3. 开启"两步验证"
4. 生成"应用专用密码"
5. 选择"邮件"应用类型

#### 163邮箱授权码
1. 登录163邮箱
2. 进入"设置" → "POP3/SMTP/IMAP"
3. 开启"IMAP/SMTP服务"
4. 设置"客户端授权密码"

#### Outlook应用密码
1. 登录Microsoft账户
2. 进入"安全性"设置
3. 开启"两步验证"
4. 创建"应用密码"

### 3. 发件人过滤
使用 `--sender-filter` 参数可以过滤特定发件人的邮件，提高验证码识别准确性。

### 4. 安全注意事项

#### 授权码方式
- **不要**在代码中硬编码授权码
- **建议**使用环境变量或配置文件存储
- **定期**更换授权码，确保账户安全

#### 真实密码方式
- **仅用于**测试和开发环境
- **避免**在生产环境使用
- **不要**在公共网络或设备上使用
- **及时**清理测试数据和日志
- **考虑**为测试创建专用邮箱账户

## 功能特点

1. **多邮箱支持**: 支持QQ、163、Gmail、Outlook等主流邮箱
2. **智能邮件识别**: 自动识别和提取验证码
3. **多重备选方案**: 支持多种验证码格式和提取方式
4. **兼容性强**: 适配不同邮箱服务商的IMAP设置
5. **灵活的认证方式**: 支持授权码和真实密码两种登录方式
6. **完善的错误处理**: 提供详细的错误信息和解决建议
7. **安全提示**: 根据使用方式提供相应的安全建议

## 故障排除

### 常见问题

1. **连接失败**
   - 检查网络连接
   - 确认邮箱服务器设置
   - 验证密码/授权码是否正确
   - 检查邮箱安全设置

2. **认证错误**
   
   **使用授权码时**:
   - 重新生成授权码
   - 检查授权码格式
   - 确认IMAP服务已开启
   
   **使用真实密码时**:
   - 确认密码正确
   - 开启"不够安全的应用"访问权限
   - 检查两步验证设置
   - 考虑使用应用专用密码

3. **找不到验证码**
   - 检查发件人过滤设置
   - 确认邮件是否已接收
   - 调整等待时间
   - 检查垃圾邮件文件夹

4. **安全限制**
   - 某些邮箱可能限制真实密码登录
   - 建议使用授权码方式
   - 检查账户安全策略

### 详细错误解决方案

#### QQ邮箱常见问题
- **错误**: "535 Login Fail"
- **解决**: 确认已开启IMAP服务并使用正确的授权码

#### Gmail常见问题
- **错误**: "535-5.7.8 Username and Password not accepted"
- **解决**: 开启两步验证并使用应用专用密码

#### 163邮箱常见问题
- **错误**: "535 Error: authentication failed"
- **解决**: 开启IMAP服务并设置客户端授权密码

## 核心模块说明

### 1. `email_verifier.py`
- **EmailVerifier类**: 核心邮箱连接和验证码获取功能
- **主要方法**:
  - `connect()`: 连接邮箱服务器
  - `wait_for_verification_code()`: 等待并获取验证码
  - `extract_verification_code()`: 从邮件中提取验证码

### 2. `verification_helper.py`
- **辅助函数**: 提供便捷的验证码获取接口
- **主要函数**:
  - `get_verification_code()`: 获取验证码的主要接口
  - `auto_input_verification_code()`: 自动输入验证码到网页
  - `get_email_setup_tips()`: 获取邮箱设置提示

## 测试和示例

### 测试文件位置
所有测试文件位于 `tests/` 文件夹中：

- `test_email_verification.py`: 完整功能测试
- `test_email_verification_simple.py`: 简化测试
- `test_real_password.py`: 真实密码功能测试

### 运行测试
```bash
# 进入测试目录
cd tests

# 运行测试
python3 test_real_password.py
python3 test_email_verification_simple.py
```

## 最佳实践

1. **开发环境**: 使用真实密码进行快速测试
2. **生产环境**: 始终使用授权码或应用专用密码
3. **安全考虑**: 定期更换密码和授权码
4. **错误处理**: 实现适当的重试机制
5. **日志记录**: 记录操作日志但避免记录敏感信息

---

**注意**: 使用本功能时请遵守相关邮箱服务商的使用条款，并注意保护个人隐私和账户安全。