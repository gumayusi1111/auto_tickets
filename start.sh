#!/bin/bash
# -*- coding: utf-8 -*-
"""
é¡¹ç›®å¯åŠ¨è„šæœ¬ - è‡ªåŠ¨æ¿€æ´»è™šæ‹Ÿç¯å¢ƒå¹¶è¿›å…¥äº¤äº’æ¨¡å¼
ä½¿ç”¨æ–¹æ³•: ./start.sh æˆ– bash start.sh
"""

# è®¾ç½®è„šæœ¬ç›®å½•ä¸ºå·¥ä½œç›®å½•
cd "$(dirname "$0")"

echo "ğŸµ Weverse è‡ªåŠ¨åŒ–å·¥å…· - ç²¾ç¡®æ—¶æœºæ§åˆ¶ç‰ˆæœ¬"
echo "=================================================="
echo "ğŸ“ é¡¹ç›®ç›®å½•: $(pwd)"
echo ""
echo "âœ¨ æ–°å¢ä¼˜åŒ–åŠŸèƒ½:"
echo "   ğŸ¯ ç²¾ç¡®åˆ°æ¯«ç§’çš„å€’è®¡æ—¶æ˜¾ç¤º"
echo "   âš¡ åŠ¨æ€ç½‘ç»œå»¶è¿Ÿæµ‹è¯•å’Œä¼˜åŒ–"
echo "   ğŸ”§ æ ¸å¿ƒç”³è¯·æŒ‰é’®ç²¾ç¡®å®šä½"
echo "   ğŸš€ ç®€åŒ–ç™»å½•æµç¨‹ï¼Œå‡å°‘ä¸å¿…è¦å»¶è¿Ÿ"
echo "   ğŸ“¡ ä¼˜åŒ–ç½‘ç»œè¯·æ±‚æ•è·æ—¶æœº"
echo ""
echo "ğŸ¯ ä½¿ç”¨è¯´æ˜:"
echo "   1. ç¨‹åºä¼šè‡ªåŠ¨è¿›è¡Œç½‘ç»œå»¶è¿Ÿæµ‹è¯•ï¼ˆ60ç§’ï¼‰"
echo "   2. å€’è®¡æ—¶ç²¾ç¡®åˆ°æ¯«ç§’ï¼Œæ˜¾ç¤ºå½“å‰æ—¶é—´å’Œç›®æ ‡æ—¶é—´"
echo "   3. è‡ªåŠ¨è®¡ç®—æœ€ä½³æå‰ç‚¹å‡»æ—¶é—´"
echo "   4. æ ¸å¿ƒç”³è¯·æŒ‰é’®ä¼˜å…ˆä½¿ç”¨ç²¾ç¡®é€‰æ‹©å™¨"
echo "   5. ç™»å½•æµç¨‹å·²ç®€åŒ–ï¼Œæ— ä¸å¿…è¦ç­‰å¾…"
echo ""
echo "âš ï¸ é‡è¦æç¤º:"
echo "   - è¯·æå‰ç™»å½•å¥½è´¦å·"
echo "   - ç¡®ä¿ç½‘ç»œè¿æ¥ç¨³å®š"
echo "   - ç¨‹åºä¼šåœ¨æœ€ä½³æ—¶æœºè‡ªåŠ¨ç‚¹å‡»ç”³è¯·æŒ‰é’®"
echo ""

# æ£€æŸ¥è™šæ‹Ÿç¯å¢ƒæ˜¯å¦å­˜åœ¨
if [ ! -d ".venv" ]; then
    echo "âŒ è™šæ‹Ÿç¯å¢ƒä¸å­˜åœ¨ï¼Œæ­£åœ¨åˆ›å»º..."
    python3 -m venv .venv
    echo "âœ… è™šæ‹Ÿç¯å¢ƒåˆ›å»ºå®Œæˆ"
fi

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
echo "ğŸš€ æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ..."
source .venv/bin/activate

echo "âœ… è™šæ‹Ÿç¯å¢ƒå·²æ¿€æ´»"
echo "ğŸ“¦ å½“å‰Pythonè·¯å¾„: $(which python)"
echo "ğŸ“¦ å½“å‰pipè·¯å¾„: $(which pip)"

# æ£€æŸ¥æ˜¯å¦éœ€è¦å®‰è£…ä¾èµ–
if [ -f "requirements.txt" ]; then
    echo ""
    echo "ğŸ“‹ æ£€æŸ¥ä¾èµ–..."
    
    # æ£€æŸ¥å…³é”®ä¾èµ–æ˜¯å¦å®‰è£…
    if ! python -c "import selenium, requests" 2>/dev/null; then
        echo "âš ï¸ å‘ç°ç¼ºå¤±ä¾èµ–ï¼Œæ­£åœ¨å®‰è£…..."
        pip install -r requirements.txt
        echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"
    else
        echo "âœ… ä¾èµ–æ£€æŸ¥é€šè¿‡"
    fi
fi

echo ""
echo "ğŸ¯ é¡¹ç›®å·²å‡†å¤‡å°±ç»ªï¼"
echo "ğŸ“ æ–°çš„æ¨¡å—åŒ–ç›®å½•ç»“æ„ï¼š"
echo "   ğŸ“‚ core/     - æ ¸å¿ƒåŠŸèƒ½"
echo "   ğŸ“‚ auth/     - è®¤è¯ç›¸å…³"
echo "   ğŸ“‚ forms/    - è¡¨å•ç›¸å…³" 
echo "   ğŸ“‚ network/  - ç½‘ç»œç›¸å…³"
echo "   ğŸ“‚ vpn/      - VPNç›¸å…³"
echo "   ğŸ“‚ archive/  - å½’æ¡£åŠŸèƒ½"
echo ""
echo "ğŸš€ å¯åŠ¨Weverseç»Ÿä¸€è‡ªåŠ¨åŒ–å·¥å…·..."
echo ""

# ä½¿ç”¨æ–°çš„é‡æ„åçš„ä¸»ç¨‹åº
python -m src.weverse.core.main

echo ""
echo "ğŸ“‹ ç¨‹åºè¿è¡Œå®Œæˆï¼"
echo ""
echo "ğŸ’¡ å…¶ä»–å¯ç”¨å‘½ä»¤:"
echo "  ğŸ§ª APIæµ‹è¯•:        python scripts/test_api.py"
echo "  ğŸµ æ¼”å”±ä¼šåˆ†æ:      python scripts/weverse_analyzer.py"
echo "  ğŸŒ Weverseç»Ÿä¸€å·¥å…·: python -m src.weverse.core.main"
echo "  ğŸš€ ç›´æ¥å¯åŠ¨:       python weverse_auto.py"
echo ""
echo "ğŸ”§ å¦‚éœ€é‡æ–°è¿è¡Œ: ./start.sh"
echo "ğŸ”§ é€€å‡ºè™šæ‹Ÿç¯å¢ƒ: deactivate"